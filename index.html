<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keystroke Dynamics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f9ff;
            background-image:
                radial-gradient(at 15% 20%, hsla(50, 100%, 80%, 0.3) 0px, transparent 50%),
                radial-gradient(at 80% 30%, hsla(190, 100%, 85%, 0.3) 0px, transparent 50%),
                radial-gradient(at 50% 85%, hsla(30, 100%, 85%, 0.3) 0px, transparent 50%);
            color: #374151;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        /* --- Reusable Components --- */
        .card {
            background: rgba(255, 255, 255, 0.45);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            border-radius: 1rem;
            padding: 2rem;
        }

        .input-field {
            width: 100%;
            margin-top: 0.5rem;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1.125rem;
            transition: all 0.3s ease;
        }
        .input-field:focus {
            outline: none;
            box-shadow: 0 0 0 2px #ec4899;
            border-color: #ec4899;
        }

        /* --- Typography --- */
        .main-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: rgba(0, 0, 0, 0.4);
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.9);
        }
        .text-muted {
            color: rgba(0, 0, 0, 0.6);
            text-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);
        }
    </style>
</head>
<body>

    <div class="w-full max-w-4xl mx-auto space-y-6">
        <h1 class="main-title">Keystroke Dynamics Logger</h1>
        
        <div class="card">
            <h2 class="text-xl md:text-2xl font-bold text-gray-700">Keystroke Dynamics Logger</h2>
            <p class="text-muted mt-2 max-w-2xl">Type the phrase in the input field below to see the real-time calculation of Dwell Time and Flight Time for each keystroke.</p>
        </div>

        <div class="card space-y-6">
            <div id="mainInterface">
                <label for="passphraseInput" class="text-sm font-medium text-gray-700">Phrase to Type:</label>
                <div id="phraseToType" class="mt-1 font-mono text-cyan-700 font-semibold text-lg p-3 bg-white/50 rounded-lg border border-gray-200"></div>
                <input type="text" id="passphraseInput" class="input-field" placeholder="Start typing here...">
            </div>
            
        </div>
    </div>

    <script>
        const ENROLLMENT_PHRASE = "Amazingly, few discotheques provide jukeboxes.";

        const passphraseInput = document.getElementById('passphraseInput');
        const phraseToType = document.getElementById('phraseToType');

        let keydownTimestamps = {}; // Temporarily maps a key to its down-time.
        let lastKeyUpTime = null;   // Stores the timestamp of the last key release.
        let lastKeyUpKey = null;    // Stores the key name of the last key release.

        function initialize() {
            phraseToType.textContent = ENROLLMENT_PHRASE;
            passphraseInput.addEventListener('keydown', handleKeydown);
            passphraseInput.addEventListener('keyup', handleKeyup);
            passphraseInput.focus();
        }

        //Handles the 'keydown' event to calculate flight time and record the press time.
        function handleKeydown(event) {
            // Guard clause: Ignore non-character keys and auto-repeats.
            if (event.key.length !== 1 || event.repeat) {
                return;
            }

            const downTime = performance.now();

            // If there was a previous key release, we can calculate the flight time.
            if (lastKeyUpTime) {
                const flightTimeMs = downTime - lastKeyUpTime;
                const flightTimeS = flightTimeMs / 1000;
                const digraph = `'${lastKeyUpKey}-${event.key}'`;
                const logMessage = `Flight Time for ${digraph}: ${flightTimeS.toFixed(3)} s`;
                logEvent(logMessage, 'flight');
            }

            // Store the start time for this key press to calculate its dwell time later.
            keydownTimestamps[event.key] = downTime;
        }

        // Handles the 'keyup' event to calculate and log the dwell time.
        function handleKeyup(event) {
            // Guard clause: Ensure we have a corresponding keydown event to prevent errors.
            if (event.key.length !== 1 || !keydownTimestamps[event.key]) {
                return;
            }

            const upTime = performance.now();
            const downTime = keydownTimestamps[event.key];

            // Calculate Dwell Time (how long the key was held down).
            const dwellTimeMs = upTime - downTime;
            const dwellTimeS = dwellTimeMs / 1000;
            const logMessage = `Dwell Time for '${event.key}': ${dwellTimeS.toFixed(3)} s`;
            logEvent(logMessage, 'dwell');

            // Save this release time for the next flight time calculation.
            lastKeyUpTime = upTime;
            lastKeyUpKey = event.key;

            // Clean up the temporary map.
            delete keydownTimestamps[event.key];
        }

        function logEvent(message, type) {
            console.log(message);
        }

        initialize();
    </script>
</body>
</html>
